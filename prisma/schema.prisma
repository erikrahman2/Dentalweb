// prisma/schema.prisma

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  ADMIN
  DOCTOR
  STAFF
}

model User {
  id           String   @id @default(cuid())
  name         String
  email        String   @unique
  passwordHash String?
  role         Role     @default(STAFF)
  isActive     Boolean  @default(true)
  otp          String?
  otpExpiry    DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Relations
  visits       Visit[] @relation("createdVisits")
  doctorVisits Visit[] @relation("doctorVisits")
  createdDentists User[] @relation("AdminDentists")
  createdBy    User?   @relation("AdminDentists", fields: [createdById], references: [id])
  createdById  String?
  doctorProfile DoctorProfile?
  
  @@index([email])
  @@index([role])
  @@index([isActive])
}

model ClinicInfo {
  id          String   @id @default(cuid())
  name        String
  address     String
  phone       String?
  email       String?
  description String? @db.Text
  updatedAt   DateTime @updatedAt
}

model Service {
  id                   String   @id @default(cuid())
  name                 String   @unique
  description          String? @db.Text
  imageUrl             String?
  price                Decimal
  category             String?
  isActive             Boolean  @default(true)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  visitServices        VisitService[]
}

model Visit {
  id            String   @id @default(cuid())
  date          DateTime @default(now())
  patientName   String
  category      String?
  price         Decimal  @default(0) @db.Decimal(10, 2)
  discount      Decimal  @default(0) @db.Decimal(10, 2)
  total         Decimal  @db.Decimal(10, 2)
  paymentMethod String?
  status        String   @default("paid")
  notes         String?

  services    VisitService[]
  
  createdBy       User?   @relation("createdVisits", fields: [createdByUserId], references: [id])
  createdByUserId String?
  
  doctor          User?   @relation("doctorVisits", fields: [doctorId], references: [id])
  doctorId        String?

  @@index([date])
  @@index([category])
  @@index([createdByUserId])
  @@index([doctorId])
}

model VisitService {
  id          String   @id @default(cuid())
  visitId     String
  serviceId   String?
  quantity    Int      @default(1)
  customName  String?
  customPrice Decimal? @db.Decimal(10, 2)
  
  visit   Visit    @relation(fields: [visitId], references: [id], onDelete: Cascade)
  service Service? @relation(fields: [serviceId], references: [id])
  
  @@index([visitId])
  @@index([serviceId])
}

model HomepageContent {
  id               Int               @id @default(1)
  heroTitle        String?
  heroSubtitle     String?
  heroDescription  String?
  heroImage        String?
  aboutTitle       String?
  aboutDescription String?
  updatedAt        DateTime          @updatedAt
  reasons          HomepageReason[]
}

model HomepageReason {
  id                Int              @id @default(autoincrement())
  key               String
  title             String
  description       String?
  imagePath         String
  order             Int              @default(0)
  homepageContentId Int
  homepageContent   HomepageContent  @relation(fields: [homepageContentId], references: [id], onDelete: Cascade)

  @@unique([homepageContentId, key])
  @@index([homepageContentId, order])
}

model FaqEntry {
  id        Int      @id @default(autoincrement())
  question  String
  answer    String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DoctorProfile {
  id        Int      @id @default(autoincrement())
  name      String
  email     String?  @unique
  photo     String?
  joinDate  String?
  daysDone  String?
  order     Int      @default(0)
  userId    String?  @unique
  user      User?    @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model GalleryItem {
  id        Int      @id @default(autoincrement())
  before    String
  after     String
  label     String?
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}